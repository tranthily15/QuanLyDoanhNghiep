@model IEnumerable<QuanLyDoanhNghiep.Models.CV>
@{
    var job = ViewBag.Job as QuanLyDoanhNghiep.Models.JobPosition;
    int pendingPage = ViewBag.PendingPage ?? 1;
    int acceptedPage = ViewBag.AcceptedPage ?? 1;
    int rejectedPage = ViewBag.RejectedPage ?? 1;
    int pageSize = ViewBag.PageSize ?? 5;
    int pendingTotal = ViewBag.PendingTotal ?? 0;
    int acceptedTotal = ViewBag.AcceptedTotal ?? 0;
    int rejectedTotal = ViewBag.RejectedTotal ?? 0;
    int pendingTotalPages = (int)Math.Ceiling((double)pendingTotal / pageSize);
    int acceptedTotalPages = (int)Math.Ceiling((double)acceptedTotal / pageSize);
    int rejectedTotalPages = (int)Math.Ceiling((double)rejectedTotal / pageSize);
}
<div class="box"></div>
<!-- Breadcrumb -->
@* <div class="breadcrumb-container"> *@
<div class="container-fluid py-2">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="@Url.Action("Index", "Home")">Trang chủ</a>
            </li>
            <li class="breadcrumb-item">
                <a href="@Url.Action("ActiveJobs", "JobPosition")">Quản lý vị trí tuyển dụng</a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
                @job.PositionName
            </li>
        </ol>
    </nav>
</div>
@* </div> *@
<div class="container-fluid py-4">
    <!-- Thông tin vị trí tuyển dụng -->
    <a href="@Url.Action("Details", "JobPosition", new { id = job.PositionID })" class="text-decoration-none text-dark">
        <div class="card shadow-sm mb-4 border-0">
            <div class="card-body d-flex flex-column flex-md-row align-items-md-center">
                <div class="me-md-4 mb-3 mb-md-0">
                    <img src="~/img/CompanyLogo/@(job.Company?.CompanyLogo ?? "default.png")"
                        alt="@job.Company?.CompanyName" class="rounded shadow-sm"
                        style="width: 80px; height: 80px; object-fit: cover; background: #f8f9fa;">
                </div>
                <div class="flex-grow-1">
                    <h3 class="fw-bold mb-2 position-name text-truncate text-dark" title="@job.PositionName"
                        data-bs-toggle="tooltip">
                        @job.PositionName
                    </h3>
                    <div class="mb-2 text-muted">
                        <i class="bi bi-building me-1"></i>@job.Company?.CompanyName
                    </div>
                    <div class="row g-2">
                        <div class="col-auto">
                            <span class="badge text-muted px-3 py-2 fs-6">
                                <i class="bi bi-people me-1"></i>
                                Số lượng tuyển: <strong>@(job.Vacancies ?? "Không giới hạn")</strong>
                            </span>
                        </div>
                        <div class="col-auto">
                            <span class="badge text-muted px-3 py-2 fs-6">
                                <i class="bi bi-cash-stack me-1"></i>
                                Lương: <strong>@(string.IsNullOrEmpty(job.Salary) ? "Thỏa thuận" : job.Salary)</strong>
                            </span>
                        </div>
                        <div class="col-auto">
                            <span class="badge text-muted px-3 py-2 fs-6">
                                <i class="bi bi-calendar-event me-1"></i>
                                Hạn nộp: <strong>@job.EndDate.ToString("dd/MM/yyyy")</strong>
                            </span>
                        </div>
                    </div>

                </div>

            </div>
        </div>
    </a>
    <div class="row g-4">
        <!-- Đang chờ duyệt -->
        <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-clock text-warning me-2"></i>Đang chờ duyệt
                        </h5>
                        <span class="badge bg-warning rounded-pill">@ViewBag.PendingTotal</span>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush cv-list">
                        @foreach (var cv in ViewBag.PendingCVs as List<QuanLyDoanhNghiep.Models.CV>)
                        {
                            <div class="list-group-item border-0 px-4 py-3">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1 text-truncate">@cv.User.FullName</h6>
                                        <p class="text-muted small mb-0">@cv.User.Email</p>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="bi bi-calendar me-1"></i>
                                        @cv.SubmissionDate?.ToString("dd/MM/yyyy")
                                    </small>
                                    <a href="@Url.Action("Details", "CV", new { id = cv.CV_ID })"
                                        class="btn btn-outline-primary btn-sm rounded-pill">
                                        <i class="bi bi-eye me-1"></i>Chi tiết
                                    </a>
                                </div>
                            </div>
                        }
                        @if ((ViewBag.PendingCVs as List<QuanLyDoanhNghiep.Models.CV>).Count == 0)
                        {
                            <div class="text-center py-4">
                                <i class="bi bi-inbox text-muted" style="font-size: 2rem;"></i>
                                <p class="text-muted mt-2 mb-0">Không có CV đang chờ duyệt</p>
                            </div>
                        }
                    </div>
                    @if (pendingTotalPages > 1)
                    {
                        <nav>
                            <ul class="pagination justify-content-center mt-3">
                                <li class="page-item @(pendingPage == 1 ? "disabled" : "")">
                                    <a class="page-link"
                                        href="@Url.Action("ByJob", new { id = job.PositionID, pendingPage = pendingPage - 1, acceptedPage = acceptedPage, rejectedPage = rejectedPage })"><i
                                            class="bi bi-chevron-left"></i></a>
                                </li>
                                @for (int i = 1; i <= pendingTotalPages; i++)
                                {
                                    <li class="page-item @(i == pendingPage ? "active" : "")">
                                        <a class="page-link"
                                            href="@Url.Action("ByJob", new { id = job.PositionID, pendingPage = i, acceptedPage = acceptedPage, rejectedPage = rejectedPage })">@i</a>
                                    </li>
                                }
                                <li class="page-item @(pendingPage == pendingTotalPages ? "disabled" : "")">
                                    <a class="page-link"
                                        href="@Url.Action("ByJob", new { id = job.PositionID, pendingPage = pendingPage + 1, acceptedPage = acceptedPage, rejectedPage = rejectedPage })"><i
                                            class="bi bi-chevron-right"></i></a>
                                </li>
                            </ul>
                        </nav>
                    }
                </div>
            </div>
        </div>
        <!-- Đã chấp nhận -->
        <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-check-circle text-success me-2"></i>Đã chấp nhận
                        </h5>
                        <span class="badge bg-success rounded-pill">@ViewBag.AcceptedTotal</span>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush cv-list">
                        @foreach (var cv in ViewBag.AcceptedCVs as List<QuanLyDoanhNghiep.Models.CV>)
                        {
                            <div class="list-group-item border-0 px-4 py-3">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1 text-truncate">@cv.User.FullName</h6>
                                        <p class="text-muted small mb-0">@cv.User.Email</p>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="bi bi-calendar me-1"></i>
                                        @cv.EvaluationDate?.ToString("dd/MM/yyyy")
                                    </small>
                                    <a href="@Url.Action("Details", "CV", new { id = cv.CV_ID })"
                                        class="btn btn-outline-primary btn-sm rounded-pill">
                                        <i class="bi bi-eye me-1"></i>Chi tiết
                                    </a>
                                </div>
                            </div>
                        }
                        @if ((ViewBag.AcceptedCVs as List<QuanLyDoanhNghiep.Models.CV>).Count == 0)
                        {
                            <div class="text-center py-4">
                                <i class="bi bi-inbox text-muted" style="font-size: 2rem;"></i>
                                <p class="text-muted mt-2 mb-0">Chưa có CV nào được chấp nhận</p>
                            </div>
                        }
                    </div>
                    <!-- Phân trang -->
                    @if (acceptedTotalPages > 1)
                    {
                        <nav>
                            <ul class="pagination justify-content-center mt-4">
                                <li class="page-item @(acceptedPage == 1 ? "disabled" : "")">
                                    <a class="page-link"
                                        href="@Url.Action("ByJob", new { id = job.PositionID, pendingPage = pendingPage, acceptedPage = acceptedPage - 1, rejectedPage = rejectedPage })"><i
                                            class="bi bi-chevron-left"></i></a>
                                </li>
                                @for (int i = 1; i <= acceptedTotalPages; i++)
                                {
                                    <li class="page-item @(i == acceptedPage ? "active" : "")">
                                        <a class="page-link"
                                            href="@Url.Action("ByJob", new { id = job.PositionID, pendingPage = pendingPage, acceptedPage = i, rejectedPage = rejectedPage })">@i</a>
                                    </li>
                                }
                                <li class="page-item @(acceptedPage == acceptedTotalPages ? "disabled" : "")">
                                    <a class="page-link"
                                        href="@Url.Action("ByJob", new { id = job.PositionID, pendingPage = pendingPage, acceptedPage = acceptedPage + 1, rejectedPage = rejectedPage })"><i
                                            class="bi bi-chevron-right"></i></a>
                                </li>
                            </ul>
                        </nav>
                    }
                </div>
            </div>
        </div>
        <!-- Đã từ chối -->
        <div class="col-md-4">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header bg-white border-0 py-3">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="bi bi-x-circle text-danger me-2"></i>Đã từ chối
                        </h5>
                        <span class="badge bg-danger rounded-pill">@ViewBag.RejectedTotal</span>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="list-group list-group-flush cv-list">
                        @foreach (var cv in ViewBag.RejectedCVs as List<QuanLyDoanhNghiep.Models.CV>)
                        {
                            <div class="list-group-item border-0 px-4 py-3">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="flex-grow-1">
                                        <h6 class="mb-1 text-truncate">@cv.User.FullName</h6>
                                        <p class="text-muted small mb-0">@cv.User.Email</p>
                                    </div>
                                </div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <small class="text-muted">
                                        <i class="bi bi-calendar me-1"></i>
                                        @cv.EvaluationDate?.ToString("dd/MM/yyyy")
                                    </small>
                                    <a href="@Url.Action("Details", "CV", new { id = cv.CV_ID })"
                                        class="btn btn-outline-primary btn-sm rounded-pill">
                                        <i class="bi bi-eye me-1"></i>Chi tiết
                                    </a>
                                </div>
                            </div>
                        }
                        @if ((ViewBag.RejectedCVs as List<QuanLyDoanhNghiep.Models.CV>).Count == 0)
                        {
                            <div class="text-center py-4">
                                <i class="bi bi-inbox text-muted" style="font-size: 2rem;"></i>
                                <p class="text-muted mt-2 mb-0">Chưa có CV nào bị từ chối</p>
                            </div>
                        }
                    </div>
                    <!-- Phân trang -->
                    @if (rejectedTotalPages > 1)
                    {
                        <nav>
                            <ul class="pagination justify-content-center mt-3">
                                <li class="page-item @(rejectedPage == 1 ? "disabled" : "")">
                                    <a class="page-link"
                                        href="@Url.Action("ByJob", new { id = job.PositionID, pendingPage = pendingPage, acceptedPage = acceptedPage, rejectedPage = rejectedPage - 1 })"><i
                                            class="bi bi-chevron-left"></i></a>
                                </li>
                                @for (int i = 1; i <= rejectedTotalPages; i++)
                                {
                                    <li class="page-item @(i == rejectedPage ? "active" : "")">
                                        <a class="page-link"
                                            href="@Url.Action("ByJob", new { id = job.PositionID, pendingPage = pendingPage, acceptedPage = acceptedPage, rejectedPage = i })">@i</a>
                                    </li>
                                }
                                <li class="page-item @(rejectedPage == rejectedTotalPages ? "disabled" : "")">
                                    <a class="page-link"
                                        href="@Url.Action("ByJob", new { id = job.PositionID, pendingPage = pendingPage, acceptedPage = acceptedPage, rejectedPage = rejectedPage + 1 })"><i
                                            class="bi bi-chevron-right"></i></a>
                                </li>
                            </ul>
                        </nav>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="footer mt-5 pt-4 pb-2">
    <div class="container">
        <div class="row gy-4 align-items-center">
            <div class="col-md-4 mb-3 mb-md-0">
                <h5 class="mb-3"><i class="bi bi-info-circle-fill me-2 "></i>THÔNG TIN LIÊN HỆ</h5>
                <p class="mb-2">Trung tâm "Việc làm và thực tập sinh viên khoa CNTT"</p>
                <p class="mb-2">
                    <i class="bi bi-geo-alt-fill me-2 "></i> Số 1 Phố Xốm, Phú Lãm, Hà Đông, Hà
                    Nội
                </p>
                <p class="mb-2"><i class="bi bi-telephone-fill me-2 "></i> 096 159 55 99</p>
                <p class="mb-0"><i class="bi bi-envelope-fill me-2"></i> khoa.cntt@dainam.edu.vn</p>
            </div>
            <div class="col-md-4 mb-3 mb-md-0">
                <h5 class="mb-3"><i class="bi bi-link-45deg me-2"></i>LIÊN KẾT</h5>
                <a href="#" class="footer-link d-block mb-2"><i class="bi bi-briefcase-fill me-2"></i>Việc làm</a>
                <a href="#" class="footer-link d-block mb-2"><i class="bi bi-mortarboard-fill me-2"></i>Thực tập</a>
                <a href="#" class="footer-link d-block mb-2"><i class="bi bi-lightbulb-fill me-2"></i>Gợi ý việc làm</a>
                <a href="#" class="footer-link d-block"><i class="bi bi-file-earmark-person-fill me-2"></i>CV</a>
            </div>
            <div class="col-md-4 text-center">
                <h5 class="mb-3"><i class="bi bi-share-fill me-2 "></i>MẠNG XÃ HỘI</h5>
                <img src="~/img/logo.png" width="100" class="mb-3 rounded-circle border shadow-sm" />
                <div>
                    <a href="#" class="footer-link fs-4 me-3"><i class="bi bi-facebook"></i></a>
                    <a href="#" class="footer-link fs-4 me-3"><i class="bi bi-youtube"></i></a>
                    <a href="#" class="footer-link fs-4"><i class="bi bi-envelope"></i></a>
                </div>
            </div>
        </div>
        <div class="text-center mt-4 small" style="opacity:0.85;">
            &copy; @DateTime.Now.Year FitJob - Khoa CNTT, Đại học Đại Nam. All rights reserved.
        </div>
    </div>
</footer>
